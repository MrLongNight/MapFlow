name: autofix.ci

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: write

jobs:
  autofix:
    name: Autofix Code Style
    runs-on: ubuntu-latest

    steps:
    - name: Repository auschecken
      uses: actions/checkout@v4

    - name: System-Abhängigkeiten installieren (ALSA für alsa-sys)
      run: |
        sudo apt-get update
        sudo apt-get install -y libasound2-dev pkg-config

    - name: Rust Toolchain einrichten
      uses: dtolnay/rust-toolchain@stable
      with:
        components: rustfmt, clippy

    - name: Install cargo-binstall
      uses: cargo-bins/cargo-binstall@main

    - name: Install cargo-sort
      run: cargo binstall -y cargo-sort

    - name: Formatierung anwenden (cargo fmt & sort)
      run: |
        cargo fmt --all
        cargo sort --workspace

    - name: Clippy --fix ausführen (Korrekturen zulassen)
      run: cargo clippy --fix --allow-dirty --allow-staged --workspace --no-default-features --features audio -- -A warnings
      continue-on-error: true

    - name: Autofix anwenden
      uses: autofix-ci/action@8bc06253bec489732e5f9c52884c7cace15c0160
